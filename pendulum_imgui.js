import"./modulepreload-polyfill.js";import{S as Y,C as $,b as Z,W as _,c as ee,e as A,f as D,M as B,g as te,h as ne,L as ie,i as oe,V as z,j as E}from"./OrbitControls.js";let h,p,f,w,v,F,P,W,i=Math.PI/2,l=Math.PI/4,a=.5,r=2.5,T=0,L=0;const V=9.8;let G=1,o=1;const S=1,y=1,g={angle1:Math.PI/2,angle2:Math.PI/4,vel1:.5,vel2:.5,m1:1,m2:1};let m=[],s;const H=750,ae=1;let U=0,C=null,N=null,k=!1;await le();O();async function re(t){return(await fetch(t)).arrayBuffer()}async function se(t,n,e=null,u=null){return e=e||new ImGui.FontConfig,e.Name=e.Name||`${t.split(/[\\\/]/).pop()}, ${n.toFixed(0)}px`,ImGui.GetIO().Fonts.AddFontFromMemoryTTF(await re(t),n,e,u)}async function le(){h=new Y,h.background=new $(1710638),p=new Z(75,window.innerWidth/window.innerHeight,.1,100),p.position.set(0,0,5),f=new _({canvas:document.getElementById("three-canvas"),antialias:!0}),f.setSize(window.innerWidth,window.innerHeight),f.setPixelRatio(window.devicePixelRatio),w=new ee(p,f.domElement),w.enableDamping=!0,w.dampingFactor=.05,w.screenSpacePanning=!1,w.maxPolarAngle=Math.PI/2,P=new A({color:9169405}),W=new A({color:16742854});const t=new D(.05,.05,S,32);t.translate(0,-S/2,0),v=new B(t,P),h.add(v);const n=new D(.05,.05,y,32);n.translate(0,-y/2,0),F=new B(n,W),v.add(F),F.position.set(0,-S,0);const e=new te;e.setAttribute("position",new ne(new Float32Array(H*3),3));const u=new ie({color:16711680,linewidth:2});s=new oe(e,u),h.add(s),await ImGui.default();const c=document.getElementById("three-canvas");ImGui.CreateContext();const d=ImGui.GetIO();d.Fonts.AddFontDefault(),C=await se("./assets/CourierPrime-Regular.ttf",16),C&&d.Fonts.Build(),ImGui.StyleColorsDark(),ImGui_Impl.Init(c),N=new ImGui.ImVec4(.3,.3,.3,1),window.addEventListener("resize",ce)}function ue(t){if(ImGui.GetCurrentContext()===null)return;ImGui_Impl.NewFrame(t),ImGui.NewFrame();let n=!1;C&&(ImGui.PushFont(C),n=!0),k=ImGui.IsWindowHovered(ImGui.ImGuiHoveredFlags.AnyWindow),ImGui.SetNextWindowPos(new ImGui.ImVec2(20,20),ImGui.Cond.FirstUseEver),ImGui.SetNextWindowSize(new ImGui.ImVec2(294,140),ImGui.Cond.FirstUseEver),ImGui.Begin("Double Pendulum UI"),ImGui.ColorEdit4("clear color",N),ImGui.Separator(),ImGui.Text(`Scene: ${h.uuid.toString()}`),ImGui.Separator(),ImGui.Text(`Material: ${P.uuid.toString()}`),ImGui.ColorEdit3("color",P.color),ImGui.Separator(),ImGui.Text(`Angular Velocity 1: ${a.toFixed(3)} rad/s`),ImGui.Text(`Angular Velocity 2: ${r.toFixed(3)} rad/s`),ImGui.Separator();const e=[a],u=[r];ImGui.SliderFloat("Velocity 1",e,-10,10)&&(a=e[0]),ImGui.SliderFloat("Velocity 2",u,-10,10)&&(r=u[0]),ImGui.Separator();const c=[G],d=[o];ImGui.SliderFloat("Mass 1",c,.5,5)&&(G=c[0]),ImGui.SliderFloat("Mass 2",d,.5,5)&&(o=d[0]),ImGui.Button("Reset Pendulum")&&(i=g.angle1,l=g.angle2,a=g.vel1,r=g.vel2,G=g.m1,o=g.m2,m=[],s&&s.geometry&&s.geometry.attributes.position&&(s.geometry.attributes.position.array.fill(0),s.geometry.attributes.position.needsUpdate=!0,s.geometry.setDrawRange(0,0))),n&&ImGui.PopFont(),ImGui.End(),ImGui.EndFrame(),ImGui.Render()}function O(t){requestAnimationFrame(O),ue(t);const n=-V*(2*G+o)*Math.sin(i),e=-o*V*Math.sin(i-2*l),u=-2*Math.sin(i-l)*o,c=r*r*y+a*a*S*Math.cos(i-l),d=S*(2*G+o-o*Math.cos(2*i-2*l));T=(n+e+u*c)/d;const b=2*Math.sin(i-l),j=a*a*S*(G+o),q=V*(G+o)*Math.cos(i),J=r*r*y*o*Math.cos(i-l),K=y*(2*G+o-o*Math.cos(2*i-2*l));L=b*(j+q+J)/K;const M=.0167;a+=T*M,r+=L*M,a*=.999999,r*=.999999;const x=5;if(a=E.clamp(a,-x,x),r=E.clamp(r,-x,x),i+=a*M,l+=r*M,v.rotation.z=i,F.rotation.z=l-i,me(F,W),U++,U%ae===0){const Q=new z(0,-y,0),X=F.localToWorld(Q.clone());m.push(X.clone()),m.length>H&&m.shift();const R=s.geometry.attributes.position.array;for(let I=0;I<m.length;I++)R[I*3]=m[I].x,R[I*3+1]=m[I].y,R[I*3+2]=m[I].z;s.geometry.attributes.position.needsUpdate=!0,s.geometry.setDrawRange(0,m.length)}k?w.enabled=!1:w.enabled=!0,w.update(),f.render(h,p),ImGui.GetCurrentContext()!=null&&ImGui.GetDrawData()!=null&&(ImGui_Impl.RenderDrawData(ImGui.GetDrawData()),f.state.reset())}function me(t,n){const e=new z;t.getWorldPosition(e);const c=(e.project(p).y+1)/2,b=new $().setHSL(c*4%1,.65,.5);n.color.copy(b)}function ce(){p.aspect=window.innerWidth/window.innerHeight,p.updateProjectionMatrix(),f.setSize(window.innerWidth,window.innerHeight)}window.onload=function(){mass1ValueSpan&&(mass1ValueSpan.textContent=`${mass1Slider.value} kg`),mass2ValueSpan&&(mass2ValueSpan.textContent=`${mass2Slider.value} kg`)};
